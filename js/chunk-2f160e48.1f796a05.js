(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2f160e48"],{"1e00":function(e,t,a){},"2d12":function(e,t,a){"use strict";a("9494")},"4c77":function(e,t,a){"use strict";a("ff95")},"7fb6":function(e,t,a){"use strict";a.r(t);var n=a("7a23"),s=Object(n["N"])("data-v-cd92cdc6");Object(n["v"])("data-v-cd92cdc6");var i={class:"chat"},c=Object(n["i"])("h2",{class:"heading"},"Сообщения",-1),r={id:"btn",type:"submit"};Object(n["t"])();var u=s((function(e,t,a,s,u,o){var d=Object(n["A"])("loader"),l=Object(n["A"])("MessageComponent");return Object(n["s"])(),Object(n["e"])("div",i,[c,Object(n["i"])("form",{class:"send",onSubmit:t[2]||(t[2]=Object(n["M"])((function(){return e.sendMsg&&e.sendMsg.apply(e,arguments)}),["prevent"]))},[Object(n["L"])(Object(n["i"])("textarea",{id:"input","onUpdate:modelValue":t[1]||(t[1]=function(t){return e.draft=t}),rows:"1"},null,512),[[n["H"],e.draft]]),Object(n["i"])("button",r,[Object(n["i"])(d,{id:"btn-loader",showing:e.isSendLoading},null,8,["showing"]),Object(n["h"])(Object(n["C"])(e.isSendLoading?"":"Отправить"),1)])],32),(Object(n["s"])(!0),Object(n["e"])(n["a"],null,Object(n["y"])(e.messages,(function(e){return Object(n["s"])(),Object(n["e"])(l,{key:e.id,message:e},null,8,["message"])})),128)),Object(n["i"])(d,{id:"loader",showing:e.isLoading},null,8,["showing"])])})),o=a("d4ec"),d=a("bee2"),l=(a("96cf"),a("1da1")),b=a("91a5"),g=a("2b2c"),m=a("9c79"),h=a("12f9"),j=function(){function e(){Object(o["a"])(this,e),this.URL_MODULE="/account",this.URL_DIALOG="/dialog",this.URL_SEND_MSG="/message",this.session=new h["a"]}return Object(d["a"])(e,[{key:"getMessages",value:function(){var e=Object(l["a"])(regeneratorRuntime.mark((function e(t){var a,n,s,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,n=this.URL_MODULE+this.URL_DIALOG,s={queryParameters:{params:{dialogKey:t}},additionalHeaders:{sessionId:this.session.getSessionId()}},e.next=5,b["b"].get(n,s);case 5:return i=e.sent,console.log("loaded",i.result),e.abrupt("return",g["a"].success(null!==(a=i.result)&&void 0!==a?a:[]));case 10:if(e.prev=10,e.t0=e["catch"](0),401!=e.t0["statusCode"]){e.next=16;break}return e.abrupt("return",g["a"].failure(new m["a"]("Авторизируйтесь!")));case 16:return e.abrupt("return",g["a"].failure(e.t0));case 17:case"end":return e.stop()}}),e,this,[[0,10]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"sendMessage",value:function(){var e=Object(l["a"])(regeneratorRuntime.mark((function e(t){var a,n,s,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,n=this.URL_MODULE+this.URL_SEND_MSG,console.log("dialogKey in chat api: ",t.dialogKey),s={additionalHeaders:{sessionId:this.session.getSessionId()}},e.next=6,b["b"].create(n,t,s);case 6:return i=e.sent,console.log("loaded",i.result),e.abrupt("return",g["a"].success(null!==(a=i.result)&&void 0!==a?a:[]));case 11:if(e.prev=11,e.t0=e["catch"](0),401!=e.t0["statusCode"]){e.next=17;break}return e.abrupt("return",g["a"].failure(new m["a"]("Авторизируйтесь!")));case 17:return e.abrupt("return",g["a"].failure(e.t0));case 18:case"end":return e.stop()}}),e,this,[[0,11]])})));function t(t){return e.apply(this,arguments)}return t}()}]),e}(),v=function(){function e(){Object(o["a"])(this,e),this.api=new j}return Object(d["a"])(e,[{key:"getMessages",value:function(e){return this.api.getMessages(e)}},{key:"sendMessage",value:function(e){return this.api.sendMessage(e)}}]),e}(),O=function(){function e(){Object(o["a"])(this,e),this.remoteDataSource=new v}return Object(d["a"])(e,[{key:"getMessages",value:function(e){return this.remoteDataSource.getMessages(e)}},{key:"sendMessage",value:function(e){return this.remoteDataSource.sendMessage(e)}}]),e}(),p=function(){function e(){Object(o["a"])(this,e),this.repository=new O}return Object(d["a"])(e,[{key:"getMessages",value:function(e){return this.repository.getMessages(e)}},{key:"sendMessage",value:function(e){return this.repository.sendMessage(e)}}]),e}(),I=Object(n["N"])("data-v-0f0f064e");Object(n["v"])("data-v-0f0f064e");var f={class:"message"},M={class:"msg-body"},y={id:"sender"},L={id:"attachments"};Object(n["t"])();var Z=I((function(e,t,a,s,i,c){var r=Object(n["A"])("Attachment");return Object(n["s"])(),Object(n["e"])("div",f,[e.message.avatarUrl?(Object(n["s"])(),Object(n["e"])("img",{key:0,id:"avatar",src:e.IMG_BASE_URL+e.message.avatarUrl},null,8,["src"])):Object(n["f"])("",!0),Object(n["i"])("div",M,[Object(n["i"])("span",y,Object(n["C"])(e.message.authorName),1),Object(n["i"])("div",{id:"text",innerHTML:e.message.message},null,8,["innerHTML"]),Object(n["i"])("div",L,[(Object(n["s"])(!0),Object(n["e"])(n["a"],null,Object(n["y"])(e.message.attachments,(function(t,a){return Object(n["s"])(),Object(n["e"])(r,{key:t.url,attachment:t,style:{marginRight:a<e.message.attachments.length+1?"8px":"0"}},null,8,["attachment","style"])})),128))])])])})),w=(a("b0c0"),Object(n["N"])("data-v-424ceb46"));Object(n["v"])("data-v-424ceb46");var G=Object(n["i"])("img",{id:"icon",src:"data:image/svg+xml;utf8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz48c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHdpZHRoPSIxOHB4IiBoZWlnaHQ9IjIycHgiIHZpZXdCb3g9IjAgMCAxOCAyMiIgdmVyc2lvbj0iMS4xIj48dGl0bGU+ZmlsZS10ZXh0PC90aXRsZT48ZyBpZD0iUGFnZS0xIiBzdHJva2U9Im5vbmUiIHN0cm9rZS13aWR0aD0iMSIgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiPjxnIGlkPSJBcnRib2FyZCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTE0NDIuMDAwMDAwLCAtMTYyOS4wMDAwMDApIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMiI+PGcgaWQ9ImZpbGUtdGV4dCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTQ0My4wMDAwMDAsIDE2MzAuMDAwMDAwKSI+PHBhdGggZD0iTTEwIDBIMmEyIDIgMCAwIDAtMiAydjE2YTIgMiAwIDAgMCAyIDJoMTJhMiAyIDAgMCAwIDItMlY2bC02LTZ6IiBpZD0iU2hhcGUiLz48cGF0aCBpZD0iU2hhcGUiIGQ9Ik0xMCAwdjZoNiIvPjxwYXRoIGQ9Ik0xMiAxMUg0IiBpZD0iU2hhcGUiLz48cGF0aCBkPSJNMTIgMTVINCIgaWQ9IlNoYXBlIi8+PHBhdGggaWQ9IlNoYXBlIiBkPSJNNiA3SDQiLz48L2c+PC9nPjwvZz48bWV0YWRhdGE+PHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIiB4bWxuczpyZGZzPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwLzAxL3JkZi1zY2hlbWEjIiB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iPjxyZGY6RGVzY3JpcHRpb24gYWJvdXQ9Imh0dHBzOi8vaWNvbnNjb3V0LmNvbS9sZWdhbCNsaWNlbnNlcyIgZGM6dGl0bGU9ImZpbGUsdGV4dCIgZGM6ZGVzY3JpcHRpb249ImZpbGUsdGV4dCIgZGM6cHVibGlzaGVyPSJJY29uc2NvdXQiIGRjOmRhdGU9IjIwMTctMDktMTUiIGRjOmZvcm1hdD0iaW1hZ2Uvc3ZnK3htbCIgZGM6bGFuZ3VhZ2U9ImVuIj48ZGM6Y3JlYXRvcj48cmRmOkJhZz48cmRmOmxpPkZlYXRoZXIgSWNvbnM8L3JkZjpsaT48L3JkZjpCYWc+PC9kYzpjcmVhdG9yPjwvcmRmOkRlc2NyaXB0aW9uPjwvcmRmOlJERj48L21ldGFkYXRhPjwvc3ZnPg=="},null,-1),D={id:"name"};Object(n["t"])();var R=w((function(e,t){var a;return Object(n["s"])(),Object(n["e"])("a",{class:"attachment",href:e.DOWNLOAD_FILE_BASE_URL+e.attachment.url,download:null!==(a=e.attachment.name)&&void 0!==a?a:"filename"},[G,Object(n["i"])("span",D,Object(n["C"])(e.attachment.name),1)],8,["href","download"])})),S=Object(n["j"])({props:{attachment:{type:Object,required:!0}},data:function(){return{DOWNLOAD_FILE_BASE_URL:"https://e.mospolytech.ru/down.php?f="}}}),A=S;a("4c77");A.render=R,A.__scopeId="data-v-424ceb46";var U=A,k=Object(n["j"])({components:{Attachment:U},props:{message:{type:Object,required:!0}},data:function(){return{IMG_BASE_URL:b["a"]}},methods:{deleteMsg:function(){alert("Not yet implemented")}},setup:function(e){}}),N=k;a("2d12");N.render=Z,N.__scopeId="data-v-0f0f064e";var J=N,z=a("2cea"),H=new p,x=Object(n["j"])({components:{MessageComponent:J,loader:z["a"]},beforeMount:function(){var e=this;console.log("key from preview: ",this.$route.query.dialogKey);var t=this.$route.query.dialogKey;this.isLoading=!0,H.getMessages(t).then((function(t){if(e.isLoading=!1,t.isSuccess)e.messages=t.value;else if(t.isFailure){var a=t.errorOrNull();alert(null!==a&&void 0!==a?a:"Неизвестная ошибка")}}))},methods:{sendMsg:function(){var e=this;if(this.draft.length>0){this.isSendLoading=!0,console.log("dialogKey from route on send: ",this.$route.query.dialogKey);var t={dialogKey:this.$route.query.dialogKey,message:this.draft};H.sendMessage(t).then((function(t){var a;(e.draft="",e.isSendLoading=!1,t.isSuccess)?e.messages=t.value:alert(null!==(a=t.errorOrNull())&&void 0!==a?a:"Неизвестная ошибка")}))}}},setup:function(){var e=Object(n["w"])({messages:[],isLoading:!0,isSendLoading:!1,draft:""});return e}}),C=x;a("d2db");C.render=u,C.__scopeId="data-v-cd92cdc6";t["default"]=C},9494:function(e,t,a){},d2db:function(e,t,a){"use strict";a("1e00")},ff95:function(e,t,a){}}]);
//# sourceMappingURL=chunk-2f160e48.1f796a05.js.map